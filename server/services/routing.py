import requests
import json

apiKey = 'be7af08d-d658-48b9-9c98-a42e12bedad8'

badPolygonCoords = [
    [
        [9.175747952191298, 48.77885842296115],
        [9.171542141928168, 48.77518205059932],
        [9.167851405445795, 48.77812316095479],
        [9.175747952191298, 48.77885842296115]
    ]
]

mediumPolygonCoords = [
    [
        [9.175747952191298, 48.77885842296115],
        [9.170641017713573, 48.78103625844229],
        [9.163860032298558, 48.77815139444933],
        [9.165362392124628, 48.77532331297032],
        [9.171542141928168, 48.77518205059932],
        [9.167851405445795, 48.77812316095479],
        [9.175747952191298, 48.77885842296115]
    ]
]

safePlaceCoords = [
    [9.159249890299517, 48.77444649574307],
    [9.187272726117374, 48.77693306770287],
    [9.156329042693785, 48.7710887126689],
    [9.180298917741725, 48.78007508188751],
    [9.159835882638732, 48.767181088145],
    [9.15640023061246, 48.77221531087668],
    [9.159523240043916, 48.782386920761266],
    [9.174948636479553, 48.78380328603663],
    [9.179389394336542, 48.776687892051074],
    [9.158339229109123, 48.78011597246679],
    [9.180623616778, 48.77643995678344],
    [9.187026466233697, 48.78243333377855],
    [9.157206388134662, 48.78128244105962],
    [9.161077228440702, 48.77015046354302],
    [9.182000484086038, 48.77925790101291],
    [9.188719423020755, 48.7687548610763],
    [9.182859253678265, 48.7694632435204],
    [9.188118346384632, 48.77429679937542],
    [9.178978010495042, 48.77345608450865],
    [9.183554054267155, 48.78303642103105],
    [9.172950284894076, 48.76717212174704],
    [9.187082059502073, 48.77615780529339],
    [9.184447215585414, 48.78351297745065],
    [9.177494803619134, 48.77487868724905],
    [9.168230330346096, 48.768562708603595],
    [9.176535153479734, 48.768554743000875],
    [9.156988043256021, 48.76751265609192],
    [9.172379460303358, 48.77497910715981],
    [9.174801439769436, 48.78023417874856],
    [9.182755920234292, 48.77584517435605],
    [9.181264536213527, 48.76999240226302],
    [9.17159833967708, 48.77399698203477],
    [9.186437792514426, 48.779033203115716],
    [9.16736858945693, 48.76804513410138],
    [9.173409899493124, 48.77224375582565],
    [9.159023566265644, 48.77544212126839],
    [9.163462388555105, 48.772374113323366]
]

def get_heatmap():
	data = {
		"badPolygonCoords": badPolygonCoords,
		"mediumPolygonCoords": mediumPolygonCoords,
		"safePlaceCoords": safePlaceCoords
	}
	return data


def get_route(origin, destination, profile):
	url = 'https://graphhopper.com/api/1/route'
	headers = {
		'Content-Type': 'application/json'
	}
	data = {
		"profile": profile,
		"points": [
			origin.split(','),  # Source coordinates
			destination.split(',')  # Target coordinates
		],
		"ch.disable": True,
		"points_encoded": False,
		"algorith": "alternative_route",
		"custom_model": {
			"priority": [
				{
					"if": "in_bad",
					"multiply_by": "0.01"
				},
				{
					"else_if": "in_medium",
					"multiply_by": "0.3"
				}
			],
			"areas": {
				"type": "FeatureCollection",
				"features": [
					{
						"type": "Feature",
						"id": "bad",
						"properties": {},
						"geometry": {
							"type": "Polygon",
							"coordinates": badPolygonCoords
						}
					},
					{
						"type": "Feature",
						"id": "medium",
						"properties": {},
						"geometry": {
							"type": "Polygon",
							"coordinates": mediumPolygonCoords
						}
					}
				]
			}
		}
	}


	query = {
	"key": apiKey
	}

	try:
		response = requests.post(url, json=data, headers=headers, params=query)

		data = response.json()
	
		if response.ok:
			ret = response.json()
		else:
			ret = {}
	except:
		ret = {}
	
	return ret
